\documentclass[format=sigplan, review=true, anonymous=true]{acmart}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{minted}
\newcommand{\minline}[1]{\mintinline{Haskell}{#1}}

%
% defining the \BibTeX command - from Oren Patashnik's original BibTeX documentation.
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08emT\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

% Rights management information.
% This information is sent to you when you complete the rights form.
% These commands have SAMPLE values in them; it is your responsibility as an author to replace
% the commands and values with those provided to you when you complete the rights form.
%
% These commands are for a PROCEEDINGS abstract or paper.
\copyrightyear{2019}
\acmYear{2019}
%\setcopyright{acmlicensed}
\acmConference[Haskell'19]{24th ACM SIGPLAN International Haskell Symposium}{September 18-23, 2019}{Berlin, Germany}

%\acmPrice{15.00}
%\acmDOI{10.1145/1122445.1122456}
%\acmISBN{978-1-4503-9999-9/18/06}

\begin{document}
\title{Deforestation for fixed-point structures}
\author{Alexandre Moine}
\email{alexandre@moine.me}

\affiliation{%
	\institution{Université Paris Diderot}
	\streetaddress{5 Rue Thomas Mann}
	\city{Paris}
	\country{France}
	\postcode{75013}
}

\begin{abstract}
Recursive structures are ubiquitous in Haskell, constructed and destructed continuously. It is known that such manipulations can sometimes be optimized to avoid the construction of intermediate structures with a process called deforestation. In this article, we propose a minimalistic automatic technique to perform it on fixed-point structures using the GHC rewrite rules system.
\end{abstract}

%
% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
% Please copy and paste the code instead of the example below.
% FROM https://dl.acm.org/ccs/ccs.cfm?id=10011012&lid=0.10011007.10011006.10011008.10011009.10011012

\begin{CCSXML}
	<ccs2012>
	<concept>
	<concept_id>10011007.10010940.10010992.10010993.10010994</concept_id>
	<concept_desc>Software and its engineering~Functionality</concept_desc>
	<concept_significance>300</concept_significance>
	</concept>
	<concept>
	<concept_id>10011007.10011006.10011008.10011009.10011012</concept_id>
	<concept_desc>Software and its engineering~Functional languages</concept_desc>
	<concept_significance>300</concept_significance>
	</concept>
	</ccs2012>
\end{CCSXML}

\ccsdesc[300]{Software and its engineering~Functionality}
\ccsdesc[300]{Software and its engineering~Functional languages}


%
% Keywords. The author(s) should pick words that accurately describe the work being
% presented. Separate the keywords with commas.

\keywords{Haskell, GHC, deforestation}

%
% This command processes the author and affiliation and title information and builds
% the first part of the formatted document.
\maketitle

\section{Introduction}

A Haskell program can be seen as the composition of many other small programs. It is often the right way to see software development but can lead to optimization problems. For example the expression:
\begin{minted}{Haskell}
foldr (+) 0 (map (* 2) xs)
\end{minted}
is equivalent to
\begin{minted}{Haskell}
foldr ((+) . (*) 2) 0 xs
\end{minted}

\noindent While the first one is more comprehensible, it builds an intermediate list that is not needed. The second version is optimized and will only go through the original list once.
This optimization, called \emph{deforestation} (introduced by Wadler \cite{WADLER1990231}) can be made at compile-time and thus allowing the user to write a readable code while the compiler optimize it when it can; this is known for a long time, well explained by Gill et al. \cite{Gill:1993:SCD:165180.165214} and implemented for lists and rose trees by Peyton Jones et al. \cite{pbr} for GHC.

Destruct a recursive structure (like \minline{foldr} for lists) is a very common operation and can be generally defined for fixed-point types (section \ref{sec:recschemes}), that is, for classical recursive types. Then, a legitimate question is to ask if we can perform deforestation, namely fusing a destruction with a construction of the original structure. Gill et al. \cite{Gill:1993:SCD:165180.165214} postulated that this was possible: we show that this is indeed achievable for fixed-point types (section \ref{sec:rectypes}). We also propose a minimalistic implementation that makes deforestation available to \emph{any} types defined using our fixed-point constructor. We prove in part the validity of technique and give specific examples.
Finally, we show that the approach taken can be extended to more complex fusion rules (section \ref{sec:para}).

\section{Recursion schemes}
\label{sec:recschemes}
\input{recschemes.tex}

\section{Deforestation on fixed-point types}
\label{sec:rectypes}
\input{deforestation.tex}

\section{Going further with paramorphisms}
\label{sec:para}
\input{para.tex}

\section{Further work}
\label{sec:related}
\input{further.tex}

\begin{acks}
I would like to thank Andrey Mokhov as he suggested me to start this paper and provided great counsels and constant encouragements during the writing. Yann Régis-Gianas, Jospeh Priou and Maxime Flin provided very useful comments and remarks during several presentations of this work.
\end{acks}


\bibliographystyle{ACM-Reference-Format}
\bibliography{publications}
\end{document}

