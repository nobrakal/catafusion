\documentclass[format=sigplan, review=true, anonymous=true]{acmart}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{minted}
\newcommand{\hs}[1]{\mintinline{Haskell}{#1}}

%
% defining the \BibTeX command - from Oren Patashnik's original BibTeX documentation.
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08emT\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

% Rights management information.
% This information is sent to you when you complete the rights form.
% These commands have SAMPLE values in them; it is your responsibility as an author to replace
% the commands and values with those provided to you when you complete the rights form.
%
% These commands are for a PROCEEDINGS abstract or paper.
\copyrightyear{2019}
\acmYear{2019}
%\setcopyright{acmlicensed}
\acmConference[Haskell'19]{24th ACM SIGPLAN International Haskell Symposium}{September 18-23, 2019}{Berlin, Germany}

%\acmPrice{15.00}
%\acmDOI{10.1145/1122445.1122456}
%\acmISBN{978-1-4503-9999-9/18/06}

\begin{document}
\title{Deforestation for fixed-point structures}
\author{Alexandre Moine}

\affiliation{%
	\institution{Université Paris Diderot}
	\streetaddress{5 Rue Thomas Mann}
	\city{Paris}
	\country{France}
	\postcode{75013}
}

\begin{abstract}
Recursive structures are ubiquitous in Haskell, constructed and destructed continuously. It is known that such manipulations can sometimes be optimized to avoid the construction of intermediate structures with a process called deforestation. In this article, we propose a minimalistic automatic technique to perform it on fixed-point structures using the GHC rewrite rules system.
\end{abstract}

%
% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
% Please copy and paste the code instead of the example below.
% FROM https://dl.acm.org/ccs/ccs.cfm?id=10011012&lid=0.10011007.10011006.10011008.10011009.10011012

\begin{CCSXML}
	<ccs2012>
	<concept>
	<concept_id>10011007.10010940.10010992.10010993.10010994</concept_id>
	<concept_desc>Software and its engineering~Functionality</concept_desc>
	<concept_significance>300</concept_significance>
	</concept>
	<concept>
	<concept_id>10011007.10011006.10011008.10011009.10011012</concept_id>
	<concept_desc>Software and its engineering~Functional languages</concept_desc>
	<concept_significance>300</concept_significance>
	</concept>
	</ccs2012>
\end{CCSXML}

\ccsdesc[300]{Software and its engineering~Functionality}
\ccsdesc[300]{Software and its engineering~Functional languages}


%
% Keywords. The author(s) should pick words that accurately describe the work being
% presented. Separate the keywords with commas.

\keywords{Haskell, GHC, deforestation}

%
% This command processes the author and affiliation and title information and builds
% the first part of the formatted document.
\maketitle

\section{Introduction}

A Haskell program can be seen as the composition of many other small programs. It is often the right way to see software development but can lead to optimization problems. For example the expression:
\begin{minted}{Haskell}
foldr (+) 0 (map (* 2) xs)
\end{minted}
is equivalent to
\begin{minted}{Haskell}
foldr ((+) . (*) 2) 0 xs
\end{minted}

\noindent While the first one is more comprehensible, it builds an intermediate list that is not needed. The second version is optimized and will go through the original list only once.
This optimization, called \emph{deforestation} (introduced by Wadler \cite{WADLER1990231}) can be made at compile-time and thus allowing the user to write a readable code while the compiler optimize it where possible; this is known for a long time, well explained by Gill et al. \cite{Gill:1993:SCD:165180.165214} and implemented twice for lists and rose trees by Peyton Jones et al. \cite{pbr} for GHC.

As explained in section \ref{sec:recschemes}, destructing a recursive structure (like \hs{foldr} for lists) is a very common operation and can be generally defined for fixed-point types, using the so-called \emph{catamorphisms} of Meijer et al. \cite{4cec4a43c86444479dc0003182424795}. The dual operation of constructing a recursive structure (like \hs{unfoldr} for lists) is also generalizable using \emph{anamorphisms} from the same authors.

On the theoretical field, fusing these operations to avoid the construction of an intermediate structure is not a fresh idea and is widely studied, originally discussed by Meijer et al. \cite{4cec4a43c86444479dc0003182424795} or later in Gill's thesis \cite{Gill1996CheapDF} focused on lists or by Johann \cite{Johann:2002:GSF:641433.641471} on general recursive structures.

The particular contribution of this paper is dual:
\begin{itemize}
\item We propose an implementation that makes deforestation available \emph{for free} to any fixed-point structures using rewrite rules, an already-in-place mechanism of GHC to deal with deforestation on lists. Our work is still fully compatible with the one already made for lists, and certainly adjustable to other rule systems. We prove in part the validity of this implementation and provide several examples (section \ref{sec:rectypes}).
\item Fixed-point types allow us to explore a more complicated fusion system, targetting more general expressions called \emph{paramorphisms} (introduced by Meertens \cite{Meertens1992}). While the theoretical basis was already studied by Domínguez and Pardo \cite{paramorphismFusion}, we propose a new implementation giving paramorphisms fusion \emph{for free} to fixed-point structures while preserving compatibility with the previously mentioned classical deforestation (section \ref{sec:para}).
\end{itemize}

\section{Recursion schemes}
\label{sec:recschemes}
\input{recschemes.tex}

\section{Deforestation on fixed-point types}
\label{sec:rectypes}
\input{deforestation.tex}

\section{Going further with paramorphisms}
\label{sec:para}
\input{para.tex}

\section{Related work}
\label{sec:related}
\input{related.tex}

\section{Further work}
\label{sec:further}
\input{further.tex}

\begin{acks}
I would like to thank Andrey Mokhov as he suggested me to start this paper and provided great counsels and constant encouragements during the writing. Yann Régis-Gianas, Jospeh Priou and Maxime Flin provided very useful comments and remarks during several presentations of this work.
\end{acks}

\bibliographystyle{ACM-Reference-Format}
\bibliography{publications}
\end{document}

